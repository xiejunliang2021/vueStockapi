vueStockapi 项目运维与部署手册 (2026版)
🏗 环境架构
本项目已从 Conda 全面迁移至 uv 包管理器，并由 systemd 进行进程守护。

Python 版本: 3.10+

包管理: uv (用于极速依赖同步与环境隔离)

Web 服务器: uWSGI (运行于项目 .venv 环境)

任务队列: Celery + Redis

定时任务: django-celery-beat (数据库驱动调度)

反向代理: Nginx (处理 HTTPS 与 静态资源映射)

🚀 日常运维命令
1. 服务状态检查
使用系统标准指令查看 Web 和 异步任务是否正常：

Bash
# 查看 Web 服务状态
sudo systemctl status vuestock-uwsgi

# 查看 Celery 任务状态
sudo systemctl status vuestock-celery
2. 重启服务 (代码更新后执行)
当你执行了 git pull 或是修改了 .env 后，必须重启服务：

Bash
# 重启所有组件
sudo systemctl restart vuestock-uwsgi vuestock-celery

# 如果修改了数据库模型，重启前记得：
uv run python manage.py migrate
3. 环境同步
如果代码中新增了依赖包（如 drf-spectacular）：

Bash
uv sync                          # 同步依赖到 .venv
uv run python manage.py collectstatic --noinput  # 收集静态文件
🔍 错误日志排查 (快速定位)
当网站出现 502 或 API 报错时，按以下顺序排查：

第一步：检查 Nginx 日志 (连接层)
如果报 (2: No such file or directory)，通常是 uwsgi.sock 路径权限问题。

Bash
sudo tail -f /var/log/nginx/error.log
第二步：检查 uWSGI 日志 (应用层)
如果 Nginx 正常但页面报 500，检查 Django 是否崩溃。

Bash
sudo journalctl -u vuestock-uwsgi -f
第三步：检查 Celery 日志 (异步任务层)
如果股票数据未更新，检查 Oracle 连接或任务报错。

Bash
sudo journalctl -u vuestock-celery -f
🛠 核心配置备忘录
1. Oracle Wallet 证书配置
Oracle Wallet 存放于 /home/opc/oracle_wallet。

关键点: sqlnet.ora 中的 DIRECTORY 必须使用绝对路径： DIRECTORY="/home/opc/oracle_wallet"

权限: 必须确保 chmod -R 755 /home/opc/oracle_wallet 且 opc 文件夹有 +x 执行权限。

2. 环境变量 (.env)
由于代码中使用了 python-decouple，必须确保 .env 包含以下变量：

WALLET_DIRECTORY: 指向 Wallet 目录。

WALLET_LOCATION: (重复项，部分历史逻辑引用)。

DB_NAME_MYSQL / DB_USER_MYSQL: 业务数据库配置。

3. API 文档支持
为避免国内网络环境下 cdn.jsdelivr.net 加载缓慢导致文档空白，项目已启用 Sidecar 模式：

已安装 drf-spectacular-sidecar。

settings.py 中已配置 REDOC_DIST: 'SIDECAR'。

📂 路径说明
项目根目录: /home/opc/vueStockapi

虚拟环境: /home/opc/vueStockapi/.venv

Unix Socket: /home/opc/vueStockapi/uwsgi.sock (权限 666)

静态资源: /home/opc/vueStockapi/static

你需要我将这段内容直接以 .md 文件的形式发送给你，或者直接帮你写入服务器上的 README.md 吗？